---
import Navbar from "@sections/Navbar.astro";
import Footer from "@sections/Footer.astro";
import { ClientRouter } from "astro:transitions";
import { SEO, type Props as SEOProps } from "astro-seo";
import { Schema } from "astro-seo-schema";
import type { WithContext, Thing } from "schema-dts";
import { AstroFont } from "astro-font";
import "@styles/global.css";

interface Props {
  seo?: SEOProps; // Optional SEO properties to customize meta tags
  schema?: WithContext<Thing>; // Optional schema.org properties for structured data
}

// Extract `seo` and `schema` from properties or define defaults
const { seo, schema } = Astro.props;
const socialImage = `${Astro.site}social.png`; // Path to the default social sharing image

// Define default JSON-LD Schema.org data if no schema is passed
const defaultSchema: WithContext<Thing> = {
  "@context": "https://schema.org",
  "@type": "WebPage",
  inLanguage: "en-US",
  "@id": Astro.url.href,
  url: Astro.url.href,
  name: "SampleStack",
  description:
    "Discover, organize, and create with thousands of high-quality audio samples. Browse loops, one-shots, and sound effects for your music production.",
  isPartOf: {
    "@type": "WebSite",
    url: `${Astro.site}`,
    name: "SampleStack",
    description:
      "SampleStack is your go-to platform for discovering and organizing high-quality audio samples for music production.",
  },
};
---

<html lang="en" class="scroll-pt-32">
  <head>
    {/* SEO Meta Tags */}
    <SEO
      charset="utf-8"
      title={seo?.title ?? "SampleStack"}
      description={seo?.description ??
        "Discover, organize, and create with thousands of high-quality audio samples. Browse loops, one-shots, and sound effects for your music production."}
      openGraph={{
        basic: {
          title: "SampleStack - Your Ultimate Audio Sample Library",
          type: "website",
          image: socialImage,
        },
        optional: {
          description:
            "Discover, organize, and create with thousands of high-quality audio samples. Build your perfect sound palette for music production.",
        },
      }}
      twitter={{
        card: "summary_large_image",
        title: "SampleStack - Your Ultimate Audio Sample Library",
        description:
          "Discover and organize high-quality audio samples for your music production. Loops, one-shots, and sound effects.",
        image: socialImage,
        imageAlt: "SampleStack Logo.",
      }}
      extend={{
        link: [
          { rel: "icon", href: "/icon.svg", type: "image/svg+xml" },
          { rel: "apple-touch-icon", href: "/apple-touch-icon.png" },
          { rel: "manifest", href: "/manifest.webmanifest" },
        ],
        meta: [
          { name: "viewport", content: "width=device-width" },
          { name: "generator", content: `${Astro.generator}` },
        ],
      }}
    />
    {/* Schema.org JSON-LD */}
    <Schema item={schema ?? defaultSchema} />

    {/* Client-Side Router for page transitions */}
    <ClientRouter />

    {/* Font Definitions */}
    <AstroFont
    config={[
      {
        src: [],
        name: "DM Sans",
        googleFontsURL: "https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,100..1000&display=swap",
        preload: true,
        display: "swap",
        selector: "h1, h2, h3, h4",
        fallback: "sans-serif",
      },
      {
        src: [],
        name: "Work Sans",
        googleFontsURL: "https://fonts.googleapis.com/css2?family=Work+Sans:wght@100..900&display=swap",
        preload: true,
        display: "swap",
        selector: "body",
        fallback: "sans-serif",
      },
    ]}
  />

   {/* Remove duplicate font links during transitions */}
   <script>
    import type { TransitionBeforeSwapEvent } from "astro:transitions/client";
    document.addEventListener("astro:before-swap", (e) =>
      [
        ...(e as TransitionBeforeSwapEvent).newDocument.head.querySelectorAll(
          'link[as="font"]',
        ),
      ].forEach((link) => link.remove()),
    );
  </script>

  {/* Google Tag Manager */}
  <script is:inline>
    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TL449CKK');
  </script>
  </head>
  <body class="bg-off-white selection:bg-orange-300 selection:text-slate-700">
    {/* Google Tag Manager (noscript) */}
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TL449CKK"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

    {/* Gradient blobs behind navbar area */}
    <div class="pointer-events-none absolute inset-x-0 top-0 h-[500px] overflow-hidden" aria-hidden="true">
      <div class="header-blob header-blob-1"></div>
      <div class="header-blob header-blob-2"></div>
      <div class="header-blob header-blob-3"></div>
    </div>

    <Navbar />

    <main>
      <slot />
    </main>

    <Footer />
  </body>
</html>

<style>
  .header-blob {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    opacity: 0.5;
    mix-blend-mode: normal;
    transform: translateZ(0);
    will-change: transform;
    backface-visibility: hidden;
  }

  .header-blob-1 {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(255, 140, 100, 0.6) 0%, rgba(255, 100, 80, 0.3) 50%, transparent 70%);
    top: -15%;
    left: -5%;
    animation: headerDrift1 25s ease-in-out infinite;
  }

  .header-blob-2 {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(255, 180, 120, 0.5) 0%, rgba(255, 150, 100, 0.2) 50%, transparent 70%);
    top: -10%;
    right: -8%;
    animation: headerDrift2 30s ease-in-out infinite;
  }

  .header-blob-3 {
    width: 350px;
    height: 350px;
    background: radial-gradient(circle, rgba(180, 120, 200, 0.4) 0%, rgba(150, 100, 180, 0.2) 50%, transparent 70%);
    top: 5%;
    left: 35%;
    animation: headerDrift3 35s ease-in-out infinite;
  }

  @keyframes headerDrift1 {
    0%, 100% { transform: translate3d(0, 0, 0) scale(1); }
    25% { transform: translate3d(60px, 30px, 0) scale(1.05); }
    50% { transform: translate3d(30px, 50px, 0) scale(0.95); }
    75% { transform: translate3d(-30px, 20px, 0) scale(1.02); }
  }

  @keyframes headerDrift2 {
    0%, 100% { transform: translate3d(0, 0, 0) scale(1); }
    25% { transform: translate3d(-40px, 30px, 0) scale(1.05); }
    50% { transform: translate3d(-70px, 15px, 0) scale(1.08); }
    75% { transform: translate3d(-20px, -20px, 0) scale(0.95); }
  }

  @keyframes headerDrift3 {
    0%, 100% { transform: translate3d(0, 0, 0) scale(1); }
    25% { transform: translate3d(-30px, -25px, 0) scale(0.95); }
    50% { transform: translate3d(40px, -15px, 0) scale(1.05); }
    75% { transform: translate3d(20px, 30px, 0) scale(1); }
  }
</style>
