---
import Button from "@ui/Button.astro";

const title = "Sample Management. Simplified.";
const subTitle =
  "The native macOS sample manager built for Eurorack and hardware samplers. Organize, validate, and convert your library for Morphagene, Squid Salmple, Digitakt, and more, so you spend less time on file prep and more time making music.";
const primaryCTA = { text: "Download Beta", href: "/releases/SampleStack-1.0.1.dmg" };
---

{/* Hero Content */}
<div class="mx-auto max-w-4xl select-none text-left sm:text-center">
  <h1
    class="block text-balance text-4xl text-slate-800 sm:text-5xl md:text-6xl lg:text-7xl"
  >
    {title}
  </h1>
</div>

<div class="mx-auto max-w-3xl text-left sm:text-center">
  <p class="text-pretty text-lg text-slate-700">
    {subTitle}
  </p>
</div>

{/* CTA Buttons */}
<div class="flex flex-col justify-center gap-5 sm:flex-row">
  <Button href={primaryCTA.href} variant="primary" target="_blank"
    >{primaryCTA.text}</Button
  >
  <Button variant="secondary" id="watch-demo-btn">Watch Demo</Button>
</div>

{/* Video Overlay */}
<div id="video-overlay" class="fixed inset-0 z-[100] hidden items-center justify-center bg-black/80 backdrop-blur-sm">
  <div class="relative w-full max-w-4xl px-4">
    <button id="close-overlay" class="absolute -top-10 right-4 text-white/70 hover:text-white transition-colors cursor-pointer" aria-label="Close video">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
    <div class="relative w-full overflow-hidden rounded-xl shadow-2xl" style="padding-bottom: 56.25%;">
      <iframe
        id="demo-video"
        class="absolute inset-0 h-full w-full"
        src=""
        title="SampleStack Demo"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
        allowfullscreen
      ></iframe>
    </div>
  </div>
</div>

<script is:inline>
  document.addEventListener('DOMContentLoaded', () => {
    const btn = document.getElementById('watch-demo-btn');
    const overlay = document.getElementById('video-overlay');
    const closeBtn = document.getElementById('close-overlay');
    const iframe = document.getElementById('demo-video');
    const videoSrc = 'https://www.youtube.com/embed/_CwE25sk300?autoplay=1&rel=0';

    function openVideo() {
      iframe.src = videoSrc;
      overlay.classList.remove('hidden');
      overlay.classList.add('flex');
    }

    function closeVideo() {
      overlay.classList.add('hidden');
      overlay.classList.remove('flex');
      iframe.src = '';
    }

    btn.addEventListener('click', openVideo);
    closeBtn.addEventListener('click', closeVideo);
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) closeVideo();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !overlay.classList.contains('hidden')) closeVideo();
    });
  });

  // Re-attach after Astro page transitions
  document.addEventListener('astro:page-load', () => {
    const btn = document.getElementById('watch-demo-btn');
    const overlay = document.getElementById('video-overlay');
    const closeBtn = document.getElementById('close-overlay');
    const iframe = document.getElementById('demo-video');
    if (!btn || !overlay) return;
    const videoSrc = 'https://www.youtube.com/embed/_CwE25sk300?autoplay=1&rel=0';

    function openVideo() {
      iframe.src = videoSrc;
      overlay.classList.remove('hidden');
      overlay.classList.add('flex');
    }

    function closeVideo() {
      overlay.classList.add('hidden');
      overlay.classList.remove('flex');
      iframe.src = '';
    }

    btn.addEventListener('click', openVideo);
    closeBtn.addEventListener('click', closeVideo);
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) closeVideo();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !overlay.classList.contains('hidden')) closeVideo();
    });
  });
</script>
